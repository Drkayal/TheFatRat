# Contract â€” Listeners and Post-Exploitation

Purpose
- Generate Metasploit handler rc files and optionally launch handlers headless; execute prebuilt post-exploitation resource scripts.

Inputs (Listener Generation)
- payload: enum (windows/shell_bind_tcp, windows/shell/reverse_tcp, windows/meterpreter/reverse_tcp, windows/meterpreter/reverse_http, windows/meterpreter/reverse_https, ...)
- lhost: IPv4/hostname
- lport: 1..65535
- output_name: string (base name without extension)
- run_immediately: boolean (start handler after generation)

Inputs (Post-Exploitation)
- script_name: enum (cred_dump, fast_migrate, auto_migrate+killfirewall, gather, sysinfo)
- session_id: string/integer (if executing against an active session)

Outputs
- artifacts:
  - output/<output_name>.rc (for listeners)
  - logs/run.log (if handler started)
  - status.json

Process (Headless)
1) For listener: write a .rc with exploit/multi/handler and payload settings.
2) If run_immediately=true: run msfconsole -x "resource <rc>; exit -y" and capture logs.
3) For post-exploit: run msfconsole -x "resource postexploit/<script>.rc; sessions -i <id>; exit -y" (flow varies by script) and capture logs.

Preconditions
- msfconsole available

Failure Cases
- Invalid payload or port
- msfconsole execution failure
- No such session id (post-exploit)

Security Notes
- Handlers bind/listen on network interfaces; ensure lab isolation before running.